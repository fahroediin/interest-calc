<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pinjaman (Standar PMT)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f4f7f9;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 650px;
        }
        h1 {
            text-align: center;
            color: #1a253c;
            margin-bottom: 30px;
            font-weight: 600;
        }
        .form-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .form-group label {
            flex-basis: 35%;
            color: #555;
            font-weight: 500;
        }
        .form-group input, .form-group select {
            flex-basis: 65%;
            padding: 12px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #007bff;
            outline: none;
        }
        .button-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
        }
        button {
            padding: 12px 30px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #004494;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9f5ff;
            border-radius: 8px;
            border: 1px solid #bce0ff;
            display: none; /* Hidden by default */
        }
        .result p {
            margin: 8px 0;
            font-size: 1.1rem;
            color: #333;
        }
        .result .value {
            font-weight: bold;
            color: #0056b3;
        }
        .result .note {
            font-size: 0.9em;
            color: #555;
            margin-top: 10px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Kalkulator Simulasi Pinjaman</h1>
        <form id="kpr-form">
            <!-- Pokok Pinjaman -->
            <div class="form-group" id="group-principal">
                <label for="principal">Principal (Pokok Pinjaman)</label>
                <!-- PERUBAHAN 1: Mengubah type ke "text" dan menambahkan inputmode -->
                <input type="text" id="principal" inputmode="numeric" placeholder="Contoh: 10.000.000" required>
            </div>
            <!-- Suku Bunga -->
            <div class="form-group" id="group-interest">
                <label for="interest">Interest Rate (% per Tahun)</label>
                <input type="number" id="interest" placeholder="Contoh: 10" step="0.01" required>
            </div>
            <!-- Tenor -->
            <div class="form-group" id="group-tenor">
                <label for="tenor">Tenor (Bulan)</label>
                <input type="number" id="tenor" placeholder="Contoh: 12" required>
            </div>
            <!-- Jenis Bunga -->
            <div class="form-group">
                <label for="interest-type">Interest Type</label>
                <select id="interest-type">
                    <option value="">--Select--</option>
                    <option value="fixed">Fixed (Anuitas)</option>
                    <option value="floating">Floating (Anuitas)</option>
                    <option value="capped">Capped (Anuitas)</option>
                    <option value="flat">Flat</option>
                    <option value="effective">Effective</option>
                    <option value="hybrid">Hybrid (Anuitas)</option>
                </select>
            </div>

            <!-- Bagian Input Tambahan (disembunyikan secara default) -->
            <div id="additional-fields">
                <div class="form-group hidden" id="group-cap-rate">
                    <label for="cap-rate">Cap Rate (% per Tahun)</label>
                    <input type="number" id="cap-rate" placeholder="Contoh: 12" step="0.01">
                </div>
                <div class="hidden" id="group-hybrid">
                     <div class="form-group">
                        <label for="fixed-tenor">Tenor Fixed (Bulan)</label>
                        <input type="number" id="fixed-tenor" placeholder="Contoh: 24">
                     </div>
                     <div class="form-group">
                        <label for="floating-rate">Interest Floating (% per Tahun)</label>
                        <input type="number" id="floating-rate" placeholder="Contoh: 9.5" step="0.01">
                     </div>
                </div>
            </div>

            <div class="button-container">
                <button type="submit">Calculate</button>
            </div>
        </form>

        <div id="result-container" class="result"></div>
    </div>

    <script>
    // --- Elemen DOM ---
    const form = document.getElementById('kpr-form');
    const principalInput = document.getElementById('principal'); // Ambil input principal
    const interestTypeSelect = document.getElementById('interest-type');
    const resultContainer = document.getElementById('result-container');
    const groupPrincipal = document.getElementById('group-principal');
    const groupInterest = document.getElementById('group-interest');
    const groupTenor = document.getElementById('group-tenor');
    const groupCapRate = document.getElementById('group-cap-rate');
    const groupHybrid = document.getElementById('group-hybrid');
    
    // --- Format Mata Uang ---
    const formatCurrency = (number) => {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency', currency: 'IDR', minimumFractionDigits: 2, maximumFractionDigits: 2
        }).format(number);
    };

    // --- PERUBAHAN 2: Menambahkan event listener untuk format delimiter ---
    principalInput.addEventListener('input', function(e) {
        // 1. Ambil nilai, hapus semua karakter non-digit
        let rawValue = e.target.value.replace(/[^0-9]/g, '');
        
        // 2. Jika ada nilai, format dengan pemisah ribuan
        if (rawValue) {
            const formattedValue = new Intl.NumberFormat('id-ID').format(rawValue);
            e.target.value = formattedValue;
        }
    });


    // --- Mengatur Tampilan Form Berdasarkan Pilihan ---
    interestTypeSelect.addEventListener('change', () => {
        const type = interestTypeSelect.value;
        
        groupPrincipal.classList.remove('hidden');
        groupInterest.classList.remove('hidden');
        groupTenor.classList.remove('hidden');
        groupCapRate.classList.add('hidden');
        groupHybrid.classList.add('hidden');
        resultContainer.style.display = 'none';

        if (type === 'capped') {
            groupCapRate.classList.remove('hidden');
        } else if (type === 'hybrid') {
            document.querySelector('#group-interest label').textContent = 'Interest Fixed (% per Tahun)';
            groupHybrid.classList.remove('hidden');
        } else if (type === 'effective') {
            groupPrincipal.classList.add('hidden');
            groupTenor.classList.add('hidden');
            document.querySelector('#group-interest label').textContent = 'Interest Nominal (% per Tahun)';
        } else {
            document.querySelector('#group-interest label').textContent = 'Interest Rate (% per Tahun)';
        }
    });

    // --- Proses Kalkulasi ---
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const type = interestTypeSelect.value;
        if (!type) {
            alert('Silakan pilih jenis bunga terlebih dahulu.');
            return;
        }

        try {
            // PERUBAHAN 3: Bersihkan delimiter sebelum melakukan parsing
            const principalValue = principalInput.value;
            const principal = parseFloat(principalValue.replace(/\./g, '')); // Hapus titik

            let annualRatePercent = parseFloat(document.getElementById('interest').value);
            const tenorMonths = parseInt(document.getElementById('tenor').value);
            let resultHTML = '';

            switch (type) {
                // ... (Logika switch case tidak berubah) ...
                case 'fixed':
                case 'floating':
                case 'capped': {
                    if (isNaN(principal) || isNaN(annualRatePercent) || isNaN(tenorMonths)) throw new Error("Input Pokok, Bunga, dan Tenor harus valid.");
                    let note = '';
                    
                    if (type === 'capped') {
                        const capRatePercent = parseFloat(document.getElementById('cap-rate').value);
                        if(isNaN(capRatePercent)) throw new Error('Cap Rate harus diisi.');
                        if (annualRatePercent > capRatePercent) {
                            note = `<p class="note">Perhitungan menggunakan Suku Bunga Batas Atas (Cap Rate) ${capRatePercent}% karena bunga input lebih tinggi.</p>`;
                            annualRatePercent = capRatePercent;
                        }
                    }
                    if (type === 'floating') {
                        note = `<p class="note">Angsuran ini dapat berubah di masa depan sesuai pergerakan suku bunga acuan.</p>`;
                    }

                    const monthlyRate = annualRatePercent / 100 / 12;
                    if (monthlyRate === 0) { 
                        monthlyPayment = principal / tenorMonths;
                    } else {
                        monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, tenorMonths)) / (Math.pow(1 + monthlyRate, tenorMonths) - 1);
                    }
                    if (!isFinite(monthlyPayment)) throw new Error("Input tidak valid untuk perhitungan anuitas.");

                    resultHTML = `<p>Angsuran Bulanan (Anuitas): <span class="value">${formatCurrency(monthlyPayment)}</span></p>${note}`;
                    break;
                }
                
                case 'flat': {
                    if (isNaN(principal) || isNaN(annualRatePercent) || isNaN(tenorMonths)) throw new Error("Input Pokok, Bunga, dan Tenor harus valid.");
                    const annualRate = annualRatePercent / 100;
                    const monthlyPrincipal = principal / tenorMonths;
                    const monthlyInterest = (principal * annualRate) / 12;
                    const monthlyPayment = monthlyPrincipal + monthlyInterest;

                    resultHTML = `
                        <p>Angsuran Pokok / Bulan: <span class="value">${formatCurrency(monthlyPrincipal)}</span></p>
                        <p>Angsuran Bunga / Bulan: <span class="value">${formatCurrency(monthlyInterest)}</span></p>
                        <hr>
                        <p>Total Angsuran / Bulan: <span class="value">${formatCurrency(monthlyPayment)}</span></p>`;
                    break;
                }

                case 'effective': {
                    if (isNaN(annualRatePercent)) throw new Error("Input Suku Bunga tidak valid.");
                    const annualRate = annualRatePercent / 100;
                    const frequency = 12; 
                    const effectiveRate = (Math.pow(1 + (annualRate / frequency), frequency) - 1) * 100;

                    resultHTML = `<p>Suku Bunga Efektif (EAR): <span class="value">${effectiveRate.toFixed(2)}%</span></p>
                                  <p class="note">Ini adalah biaya bunga tahunan sebenarnya setelah memperhitungkan efek pemajemukan bulanan.</p>`;
                    break;
                }
                
                case 'hybrid': {
                    const fixedTenorMonths = parseInt(document.getElementById('fixed-tenor').value);
                    const floatingRatePercent = parseFloat(document.getElementById('floating-rate').value);
                    if(isNaN(principal) || isNaN(annualRatePercent) || isNaN(tenorMonths) || isNaN(fixedTenorMonths) || isNaN(floatingRatePercent)) throw new Error("Semua input hybrid harus diisi.");

                    const monthlyFixedRate = annualRatePercent / 100 / 12;
                    const fixedPayment = principal * (monthlyFixedRate * Math.pow(1 + monthlyFixedRate, tenorMonths)) / (Math.pow(1 + monthlyFixedRate, tenorMonths) - 1);
                    
                    let remainingPrincipal = principal;
                    for (let i = 0; i < fixedTenorMonths; i++) {
                        let interestPart = remainingPrincipal * monthlyFixedRate;
                        let principalPart = fixedPayment - interestPart;
                        remainingPrincipal -= principalPart;
                    }

                    const remainingMonths = tenorMonths - fixedTenorMonths;
                    const monthlyFloatingRate = floatingRatePercent / 100 / 12;
                    const floatingPayment = remainingPrincipal * (monthlyFloatingRate * Math.pow(1 + monthlyFloatingRate, remainingMonths)) / (Math.pow(1 + monthlyFloatingRate, remainingMonths) - 1);

                     resultHTML = `
                        <p>Angsuran Periode Fixed (${fixedTenorMonths} bulan): <span class="value">${formatCurrency(fixedPayment)}</span></p>
                        <p>Perkiraan Angsuran Periode Floating: <span class="value">${formatCurrency(floatingPayment)}</span></p>
                        <p class="note">Sisa pokok setelah periode fixed: ${formatCurrency(remainingPrincipal)}</p>`;
                    break;
                }
            }
            resultContainer.innerHTML = resultHTML;
            resultContainer.style.display = 'block';

        } catch (error) {
            resultContainer.innerHTML = `<p style="color:red;"><strong>Error:</strong> ${error.message}</p>`;
            resultContainer.style.display = 'block';
        }
    });
    </script>
</body>
</html>